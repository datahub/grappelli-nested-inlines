var grp={jQuery:jQuery.noConflict(true)};var django={jQuery:grp.jQuery.noConflict(true)};(function(e){grappelli.getFormat=function(e){if(e=="date"){var t=DATE_FORMAT.toLowerCase().replace(/%\w/g,function(e){e=e.replace(/%/,"");return e+e});return t}};grappelli.initDateAndTimePicker=function(){e("p.datetime").each(function(){var t=e(this).html();t=t.replace(/^\w*: /,"");t=t.replace(/<br>[^<]*: /g,"<br>");e(this).html(t)});var t={constrainInput:false,showOn:"button",buttonImageOnly:false,buttonText:"",dateFormat:grappelli.getFormat("date"),showButtonPanel:true,showAnim:"",beforeShow:function(e,t,n){grappelli.datepicker_instance=this}};var n=e("input[class*='vDateField']:not([id*='__prefix__'])");n.datepicker(t);if(typeof IS_POPUP!="undefined"&&IS_POPUP){n.datepicker("disable")}e(".ui-datepicker-current").on("click",function(){e.datepicker._selectDate(grappelli.datepicker_instance);grappelli.datepicker_instance=null});e("input[class*='vTimeField']:not([id*='__prefix__'])").grp_timepicker()};grappelli.initFilter=function(){e("a.grp-pulldown-handler").click(function(){var t=e(this).closest(".grp-pulldown-container");e(t).toggleClass("grp-pulldown-state-open").children(".grp-pulldown-content").toggle()});e("a.grp-pulldown-handler").bind("mouseout",function(){e(this).blur()});e(".grp-filter-choice").change(function(){location.href=e(this).val()})};grappelli.initSearchbar=function(){var t=e("input.grp-search-field");t.focus()};grappelli.updateSelectFilter=function(e){if(typeof SelectFilter!="undefined"){e.find(".selectfilter").each(function(e,t){var n=t.name.split("-");SelectFilter.init(t.id,n[n.length-1],false,"{% admin_media_prefix %}")});e.find(".selectfilterstacked").each(function(e,t){var n=t.name.split("-");SelectFilter.init(t.id,n[n.length-1],true,"{% admin_media_prefix %}")})}};grappelli.reinitDateTimeFields=function(e){e.find(".vDateField").datepicker({constrainInput:false,showOn:"button",buttonImageOnly:false,buttonText:"",dateFormat:grappelli.getFormat("date")});e.find(".vTimeField").grp_timepicker()};grappelli.get_app_label=function(e){var t=e.next("a");if(t.length>0){var n=t.attr("href").split("/");return n[n.length-3]}return false};grappelli.get_model_name=function(e){var t=e.next("a");if(t.length>0){var n=t.attr("href").split("/");return n[n.length-2]}return false};grappelli.get_query_string=function(e){var t=e.next("a");if(t.length>0){var n=t.attr("href").split("/");pairs=n[n.length-1].replace("?","").split("&");return pairs.join(":")}return false}})(grp.jQuery);(function(e){var t={init:function(t){t=e.extend({},e.fn.grp_autocomplete_fk.defaults,t);return this.each(function(){var o=e(this);o.attr({tabindex:"-1",readonly:"readonly"}).addClass("grp-autocomplete-hidden-field");if(o.next().next()&&o.next().next().attr("class")!="errorlist"&&o.next().next().attr("class")!="grp-help")o.next().next().remove();o.next().after(n).after(r(o.attr("id")));o.parent().wrapInner("<div class='grp-autocomplete-wrapper-fk'></div>");o.parent().prepend("<input id='"+o.attr("id")+"-autocomplete' type='text' class='vTextField' value='' />");t=e.extend({wrapper_autocomplete:o.parent(),input_field:o.prev(),remove_link:o.next().next().hide(),loader:o.next().next().next().hide()},e.fn.grp_autocomplete_fk.defaults,t);s(o,t);i(o,t);o.bind("change focus keyup",function(){s(o,t)});e("label[for='"+o.attr("id")+"']").each(function(){e(this).attr("for",o.attr("id")+"-autocomplete")})})}};e.fn.grp_autocomplete_fk=function(n){if(t[n]){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" does not exist on jQuery.grp_autocomplete_fk")}return false};var n=function(){var t=e('<div class="grp-loader">loader</div>');return t};var r=function(t){var n=e('<a class="grp-related-remove"></a>');n.attr("id","remove_"+t);n.attr("href","javascript://");n.attr("onClick","return removeRelatedObject(this);");n.hover(function(){e(this).parent().toggleClass("grp-autocomplete-preremove")});return n};var i=function(t,n){n.wrapper_autocomplete.find("input:first").bind("focus",function(){n.wrapper_autocomplete.addClass("grp-state-focus")}).bind("blur",function(){n.wrapper_autocomplete.removeClass("grp-state-focus")}).autocomplete({minLength:1,delay:1e3,source:function(r,i){e.ajax({url:n.autocomplete_lookup_url,dataType:"json",data:"term="+encodeURIComponent(r.term)+"&app_label="+grappelli.get_app_label(t)+"&model_name="+grappelli.get_model_name(t)+"&query_string="+grappelli.get_query_string(t),beforeSend:function(e){n.loader.show()},success:function(t){i(e.map(t,function(e){return{label:e.label,value:e.value}}))},complete:function(e,t){n.loader.hide()}})},focus:function(){return false},select:function(r,i){n.input_field.val(i.item.label);t.val(i.item.value);t.val()?e(n.remove_link).show():e(n.remove_link).hide();return false}}).data("ui-autocomplete")._renderItem=function(t,n){if(!n.value){return e("<li></li>").data("item.autocomplete",n).append("<span class='error'>"+n.label).appendTo(t)}else{return e("<li></li>").data("item.autocomplete",n).append("<a>"+n.label).appendTo(t)}}};var s=function(t,n){e.getJSON(n.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t)},function(r){e.each(r,function(i){n.input_field.val(r[i].label);t.val()?e(n.remove_link).show():e(n.remove_link).hide()})})};e.fn.grp_autocomplete_fk.defaults={autocomplete_lookup_url:"",lookup_url:""}})(grp.jQuery);(function(e){var t={init:function(t){t=e.extend({},e.fn.grp_autocomplete_generic.defaults,t);return this.each(function(){var a=e(this);a.attr({tabindex:"-1",readonly:"readonly"}).addClass("grp-autocomplete-hidden-field");var f=e(t.content_type).val()||e(t.content_type).find(":checked").val();if(f){a.after(n).after(r(a.attr("id"))).after(i(a.attr("id"),f))}a.parent().wrapInner("<div class='grp-autocomplete-wrapper-fk'></div>");a.parent().prepend("<input id='"+a.attr("id")+"-autocomplete' type='text' class='vTextField' value='' />");t=e.extend({wrapper_autocomplete:e(this).parent(),input_field:e(this).prev(),remove_link:a.nextAll("a.grp-related-remove").hide(),loader:a.nextAll("div.grp-loader").hide()},e.fn.grp_autocomplete_generic.defaults,t);if(f){u(a,t)}o(a,t);a.bind("change focus keyup",function(){u(a,t)});e(t.content_type).bind("change",function(){s(e(this),t)});e("label[for='"+a.attr("id")+"']").each(function(){e(this).attr("for",a.attr("id")+"-autocomplete")})})}};e.fn.grp_autocomplete_generic=function(n){if(t[n]){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" does not exist on jQuery.grp_autocomplete_generic")}return false};var n=function(){var t=e('<div class="grp-loader">loader</div>');return t};var r=function(t){var n=e('<a class="grp-related-remove"></a>');n.attr("id","remove_"+t);n.attr("href","javascript://");n.attr("onClick","return removeRelatedObject(this);");n.hover(function(){e(this).parent().toggleClass("grp-autocomplete-preremove")});return n};var i=function(t,n){var r=e('<a class="related-lookup"></a>');r.attr("id","lookup_"+t);r.attr("href","../../../"+MODEL_URL_ARRAY[n].app+"/"+MODEL_URL_ARRAY[n].model+"/?t=id");r.attr("onClick","return showRelatedObjectLookupPopup(this);");return r};var s=function(t,s){var o=e(s.object_id);o.val("");o.prev().val("");o.nextAll("a.related-lookup").remove();o.nextAll("a.grp-related-remove").remove();o.nextAll("div.grp-loader").remove();var u=e(t).val()||e(t).find(":checked").val();if(u){o.after(n).after(r(o.attr("id"))).after(i(o.attr("id"),u));s.remove_link=o.nextAll("a.grp-related-remove").hide();s.loader=o.nextAll("div.grp-loader").hide()}};var o=function(t,n){n.wrapper_autocomplete.find("input:first").bind("focus",function(){n.wrapper_autocomplete.addClass("grp-state-focus")}).bind("blur",function(){n.wrapper_autocomplete.removeClass("grp-state-focus")}).autocomplete({minLength:1,delay:1e3,source:function(r,i){e.ajax({url:n.autocomplete_lookup_url,dataType:"json",data:"term="+encodeURIComponent(r.term)+"&app_label="+grappelli.get_app_label(t)+"&model_name="+grappelli.get_model_name(t)+"&query_string="+grappelli.get_query_string(t),beforeSend:function(t){var r=e(n.content_type).val()||e(n.content_type).find(":checked").val();if(r){n.loader.show()}else{return false}},success:function(t){i(e.map(t,function(e){return{label:e.label,value:e.value}}))},complete:function(e,t){n.loader.hide()}})},focus:function(){return false},select:function(r,i){n.input_field.val(i.item.label);t.val(i.item.value);t.val()?e(n.remove_link).show():e(n.remove_link).hide();return false}}).data("ui-autocomplete")._renderItem=function(t,n){if(!n.value){return e("<li></li>").data("item.autocomplete",n).append("<span class='error'>"+n.label).appendTo(t)}else{return e("<li></li>").data("item.autocomplete",n).append("<a>"+n.label).appendTo(t)}}};var u=function(t,n){e.getJSON(n.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t)},function(r){e.each(r,function(i){n.input_field.val(r[i].label);t.val()?e(n.remove_link).show():e(n.remove_link).hide()})})};e.fn.grp_autocomplete_generic.defaults={autocomplete_lookup_url:"",lookup_url:"",content_type:"",object_id:""}})(grp.jQuery);(function(e){var t={init:function(t){t=e.extend({},e.fn.grp_autocomplete_m2m.defaults,t);return this.each(function(){var n=e(this);n.attr({tabindex:"-1",readonly:"readonly"}).addClass("grp-autocomplete-hidden-field");n.next().after(i).after(s(n.attr("id")));n.parent().wrapInner("<div class='grp-autocomplete-wrapper-m2m'></div>");n.parent().prepend("<ul class='grp-repr'><li class='grp-search'><input id='"+n.attr("id")+"-autocomplete' type='text' class='vTextField' value='' /></li></ul>");t=e.extend({wrapper_autocomplete:n.parent(),wrapper_repr:n.parent().find("ul.grp-repr"),wrapper_search:n.parent().find("li.grp-search"),remove_link:n.next().next().hide(),loader:n.next().next().next().hide()},e.fn.grp_autocomplete_m2m.defaults,t);if(n.parent().find("ul.errorlist")){n.parent().find("ul.errorlist").detach().appendTo(n.parent().parent())}a(n,t);u(n,t);n.bind("change focus keyup",function(){a(n,t)});e("label[for='"+n.attr("id")+"']").each(function(){e(this).attr("for",n.attr("id")+"-autocomplete")});t.wrapper_autocomplete.bind("click",function(n){if(!e(n.target).hasClass("related-lookup")&&!e(n.target).hasClass("grp-related-remove")){t.wrapper_search.find("input:first").focus()}})})}};e.fn.grp_autocomplete_m2m=function(n){if(t[n]){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" does not exist on jQuery.grp_autocomplete_m2m")}return false};var n=function(e,t,n){var r=[];if(e.val())r=e.val().split(",");r.push(t);e.val(r.join(","));return r.join(",")};var r=function(e,t,n){var r=[];if(e.val())r=e.val().split(",");r.splice(t,1);e.val(r.join(","));return r.join(",")};var i=function(){var t=e('<div class="grp-loader">loader</div>');return t};var s=function(t){var n=e('<a class="grp-related-remove"></a>');n.attr("id","remove_"+t);n.attr("href","javascript://");n.attr("onClick","return removeRelatedObject(this);");n.hover(function(){e(this).parent().toggleClass("grp-autocomplete-preremove")});return n};var o=function(t,n,i){var s=e('<li class="grp-repr"></li>');var o=e('<a class="grp-m2m-remove" href="javascript://">'+n+"</a>");s.append(o);s.insertBefore(i.wrapper_search);o.bind("click",function(n){var s=e(this).parent().parent().children("li").index(e(this).parent());r(t,s,i);e(this).parent().remove();t.val()?e(i.remove_link).show():e(i.remove_link).hide();n.stopPropagation()});o.hover(function(){e(this).parent().toggleClass("grp-autocomplete-preremove")})};var u=function(t,r){r.wrapper_search.find("input:first").bind("keydown",function(t){if(t.keyCode===e.ui.keyCode.TAB&&e(this).data("autocomplete").menu.active){t.preventDefault()}}).bind("focus",function(){r.wrapper_autocomplete.addClass("grp-state-focus")}).bind("blur",function(){r.wrapper_autocomplete.removeClass("grp-state-focus")}).autocomplete({minLength:1,delay:1e3,position:{my:"left top",at:"left bottom",of:r.wrapper_autocomplete},open:function(t,n){e(".ui-menu").width(r.wrapper_autocomplete.outerWidth()-6)},source:function(n,i){e.ajax({url:r.autocomplete_lookup_url,dataType:"json",data:"term="+encodeURIComponent(n.term)+"&app_label="+grappelli.get_app_label(t)+"&model_name="+grappelli.get_model_name(t)+"&query_string="+grappelli.get_query_string(t),beforeSend:function(e){r.loader.show()},success:function(t){i(e.map(t,function(e){return{label:e.label,value:e.value}}))},complete:function(e,t){r.loader.hide()}})},focus:function(){return false},select:function(i,s){o(t,s.item.label,r);n(t,s.item.value,r);t.val()?e(r.remove_link).show():e(r.remove_link).hide();e(this).val("").focus();return false}}).data("ui-autocomplete")._renderItem=function(t,n){if(!n.value){return e("<li></li>").data("item.autocomplete",n).append("<span class='error'>"+n.label).appendTo(t)}else{return e("<li></li>").data("item.autocomplete",n).append("<a>"+n.label).appendTo(t)}}};var a=function(t,n){e.getJSON(n.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t)},function(r){n.wrapper_repr.find("li.grp-repr").remove();n.wrapper_search.find("input").val("");e.each(r,function(e){if(r[e].value)o(t,r[e].label,n)});t.val()?e(n.remove_link).show():e(n.remove_link).hide()})}})(grp.jQuery);(function(e){e.fn.grp_collapsible_group=function(n){var r={open_handler_slctr:".grp-open-handler",close_handler_slctr:".grp-close-handler",collapsible_container_slctr:".grp-collapse",closed_css:"grp-closed",open_css:"grp-open",on_init:function(){},on_open:function(){},on_close:function(){}};n=e.extend(r,n);return this.each(function(){t(e(this),n)})};var t=function(e,t){t.on_init(e,t);n(e,t)};var n=function(e,t){r(e,t);i(e,t)};var r=function(t,n){t.find(n.open_handler_slctr).each(function(){e(this).click(function(){n.on_open(t,n);t.find(n.collapsible_container_slctr).removeClass(n.closed_css).addClass(n.open_css);t.removeClass(n.closed_css).addClass(n.open_css)})})};var i=function(t,n){t.find(n.close_handler_slctr).each(function(){e(this).click(function(){n.on_close(t,n);t.find(n.collapsible_container_slctr).removeClass(n.open_css).addClass(n.closed_css)})})}})(grp.jQuery);(function(e){e.fn.grp_collapsible=function(n){var r={toggle_handler_slctr:".grp-collapse-handler:first",closed_css:"grp-closed",open_css:"grp-open",on_init:function(){},on_toggle:function(){}};var i=e.extend(r,n);return this.each(function(){t(e(this),i)})};var t=function(e,t){t.on_init(e,t);n(e,t)};var n=function(e,t){r(e,t)};var r=function(e,t){e.children(t.toggle_handler_slctr).click(function(){e.toggleClass(t.closed_css).toggleClass(t.open_css);t.on_toggle(e,t)})}})(grp.jQuery);(function(e){var t={init:function(t){t=e.extend({},e.fn.grp_related_generic.defaults,t);return this.each(function(){var s=e(this);var o=e(t.content_type).val()||e(t.content_type).find(":checked").val();if(o){s.after(t.placeholder).after(n(s.attr("id"),o))}s.addClass("grp-has-related-lookup");if(o){i(s,t)}s.bind("change focus keyup",function(){i(s,t)});e(t.content_type).bind("change",function(){r(e(this),t)})})}};e.fn.grp_related_generic=function(n){if(t[n]){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" does not exist on jQuery.grp_related_generic")}return false};var n=function(t,n){var r=e('<a class="related-lookup"></a>');r.attr("id","lookup_"+t);r.attr("href","../../../"+MODEL_URL_ARRAY[n].app+"/"+MODEL_URL_ARRAY[n].model+"/?t=id");r.attr("onClick","return showRelatedObjectLookupPopup(this);");return r};var r=function(t,r){var i=e(r.object_id);i.val("");i.parent().find("a.related-lookup").remove();i.parent().find(".grp-placeholder-related-generic").remove();var s=e(t).val()||e(t).find(":checked").val();if(s){i.after(r.placeholder).after(n(i.attr("id"),s))}};var i=function(t,n){var r=t.next().next();e.getJSON(n.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t),query_string:grappelli.get_query_string(t)},function(e){if(e[0].label===""){r.hide()}else{r.show()}r.html('<span class="grp-placeholder-label">'+e[0].label+"</span>")})};e.fn.grp_related_generic.defaults={placeholder:'<div class="grp-placeholder-related-generic" style="display:none"></div>',repr_max_length:30,lookup_url:"",content_type:"",object_id:""}})(grp.jQuery);(function(e){var t={init:function(t){t=e.extend({},e.fn.grp_related_m2m.defaults,t);return this.each(function(){var r=e(this);r.parent().find("a.related-lookup").after(t.placeholder);r.next().addClass("grp-m2m");r.addClass("grp-has-related-lookup");n(r,t);r.bind("change focus keyup",function(){n(r,t)})})}};e.fn.grp_related_m2m=function(n){if(t[n]){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" does not exist on jQuery.grp_related_m2m")}return false};var n=function(t,n){e.getJSON(n.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t),query_string:grappelli.get_query_string(t)},function(n){values=e.map(n,function(e){return'<span class="grp-placeholder-label">'+e.label+"</span>"});if(values===""){t.parent().find(".grp-placeholder-related-m2m").hide()}else{t.parent().find(".grp-placeholder-related-m2m").show()}t.parent().find(".grp-placeholder-related-m2m").html(values.join('<span class="grp-separator"></span>'))})};e.fn.grp_related_m2m.defaults={placeholder:'<div class="grp-placeholder-related-m2m"></div>',repr_max_length:30,lookup_url:""}})(grp.jQuery);(function(e){var t={init:function(t){t=e.extend({},e.fn.grp_related_fk.defaults,t);return this.each(function(){var r=e(this);var i=r.parent();if(i.find("a.related-lookup").next().is("strong")){i.find("a.related-lookup").get(0).nextSibling.nodeValue="";i.find("a.related-lookup").next("strong").remove()}i.find("a.related-lookup").after(t.placeholder);r.addClass("grp-has-related-lookup");n(r,t);r.bind("change focus keyup",function(){n(r,t)})})}};e.fn.grp_related_fk=function(n){if(t[n]){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" does not exist on jQuery.grp_related_fk")}return false};var n=function(t,n){var r=t.parent().find(".grp-placeholder-related-fk");e.getJSON(n.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t),query_string:grappelli.get_query_string(t)},function(e){if(e[0].label===""){r.hide()}else{r.show()}r.html('<span class="grp-placeholder-label">'+e[0].label+"</span>")})};e.fn.grp_related_fk.defaults={placeholder:'<div class="grp-placeholder-related-fk"></div>',repr_max_length:30,lookup_url:""}})(grp.jQuery);(function(e){e.widget("ui.grp_timepicker",{options:{template:'<div id="ui-timepicker" class="module" style="position: absolute; display: none;"></div>',timepicker_selector:"#ui-timepicker",offset:{top:0},default_time_list:["now","00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],time_list:[]},_create:function(){var t=this;e(document).mousedown(function(n){if(t.timepicker.is(":visible")){var r=e(n.target);if(r[0].id!=t.timepicker[0].id&&r.parents(t.options.timepicker_selector).length===0&&!r.hasClass("hasTimepicker")&&!r.hasClass("ui-timepicker-trigger")){t.timepicker.hide()}}});e(document).keyup(function(e){if(e.keyCode==27){t.timepicker.hide()}});if(e(this.options.timepicker_selector).size()===0){e(this.options.template).appendTo("body")}this.timepicker=e(this.options.timepicker_selector);this.timepicker.hide();this.element.addClass("hasTimepicker");this.button=e('<button type="button" class="ui-timepicker-trigger"></button>');this.element.after(this.button);if(this.element.prop("disabled")){this.button.prop("disabled",true)}else{this.button.click(function(){t._toggleTimepicker()})}},_toggleTimepicker:function(){if(this.timepicker.is(":visible")){this.timepicker.hide()}else{this.element.focus();this._generateTimepickerContents();this._showTimepicker()}},_generateTimepickerContents:function(){var t=this,n="<ul>";if(this.options.time_list.length===0){this.options.time_list=this.options.default_time_list}for(var r=0;r<this.options.time_list.length;r++){if(this.options.time_list[r]=="now"){var i=new Date,s=i.getHours(),o=i.getMinutes();s=s<10?"0"+s:s;o=o<10?"0"+o:o;n+='<li class="ui-state-active row">'+s+":"+o+"</li>"}else{n+='<li class="ui-state-default row">'+this.options.time_list[r]+"</li>"}}n+="</ul>";this.timepicker.html(n);this.timepicker.find("li").click(function(){e(this).parent().children("li").removeClass("ui-state-active");e(this).addClass("ui-state-active");t.element.val(e(this).html());t.timepicker.hide()})},_showTimepicker:function(){var e=document.documentElement.clientHeight;var t=document.documentElement.scrollTop||document.body.scrollTop;var n=this.element.outerHeight();var r=this.timepicker.outerHeight()+n;var i=this.element.offset().top;var s=this.element.offset().left;var o=i-t+r+60;if(o<e){var u=i+n;this.timepicker.css("left",s+"px").css("top",u+"px")}else{var a=i-r+n;this.timepicker.css("left",s+"px").css("top",a+"px")}this.timepicker.show()},destroy:function(){e.Widget.prototype.destroy.apply(this,arguments)}})})(grp.jQuery);(function(e){e.fn.grp_inline=function(t){var n={prefix:"form",addText:"add another",deleteText:"remove",addCssClass:"grp-add-handler",removeCssClass:"grp-remove-handler",deleteCssClass:"grp-delete-handler",emptyCssClass:"grp-empty-form",formCssClass:"grp-dynamic-form",predeleteCssClass:"grp-predelete",onBeforeInit:function(e){},onBeforeAdded:function(e){},onBeforeRemoved:function(e){},onBeforeDeleted:function(e){},onAfterInit:function(e){},onAfterAdded:function(e){},onAfterRemoved:function(e){},onAfterDeleted:function(e){}};t=e.extend(n,t);return this.each(function(){var n=e(this);var r=n.find("#id_"+t.prefix+"-TOTAL_FORMS");r.attr("autocomplete","off");initInlineForms(n,t);initAddButtons(n,t);addButtonHandler(n.find("a."+t.addCssClass),t);removeButtonHandler(n.find("a."+t.removeCssClass),t);deleteButtonHandler(n.find("a."+t.deleteCssClass),t)})};updateFormIndex=function(t,n,r,i){t.find(":input,span,table,iframe,label,a,ul,p,img,div").each(function(){var t=e(this),n=t.attr("id"),s=t.attr("name"),o=t.attr("for"),u=t.attr("href"),a=t.attr("class"),f=t.attr("onclick");if(n){t.attr("id",n.replace(r,i))}if(s){t.attr("name",s.replace(r,i))}if(o){t.attr("for",o.replace(r,i))}if(u){t.attr("href",u.replace(r,i))}if(a){t.attr("class",a.replace(r,i))}if(f){t.attr("onclick",f.replace(r,i))}})};initInlineForms=function(t,n){t.find("div.grp-module").each(function(){var t=e(this);n.onBeforeInit(t);if(t.attr("id")!==""){t.not("."+n.emptyCssClass).not(".grp-table").not(".grp-thead").not(".add-item").addClass(n.formCssClass)}t.find("li.grp-delete-handler-container input").each(function(){if(e(this).is(":checked")&&t.hasClass("has_original")){t.toggleClass(n.predeleteCssClass)}});n.onAfterInit(t)})};initAddButtons=function(e,t){var n=e.find("#id_"+t.prefix+"-TOTAL_FORMS");var r=e.find("#id_"+t.prefix+"-MAX_NUM_FORMS");var i=e.find("a."+t.addCssClass);if(r.val()!==""&&r.val()-n.val()<=0){hideAddButtons(e,t)}};addButtonHandler=function(e,t){e.bind("click",function(){var n=e.parents(".grp-group"),r=n.find("#id_"+t.prefix+"-TOTAL_FORMS"),i=n.find("#id_"+t.prefix+"-MAX_NUM_FORMS"),s=n.find("a."+t.addCssClass),o=n.find("#"+t.prefix+"-empty");t.onBeforeAdded(n);alert("AAA");var u=parseInt(r.val(),10),a=o.clone(true);a.removeClass(t.emptyCssClass).attr("id",o.attr("id").replace("-empty",u));var f=/__prefix__/g;updateFormIndex(a,t,f,u);a.insertBefore(o).addClass(t.formCssClass);r.val(u+1);if(i.val()!==0&&i.val()!==""&&i.val()-r.val()<=0){hideAddButtons(n,t)}t.onAfterAdded(a)})};removeButtonHandler=function(t,n){t.bind("click",function(){var r=t.parents(".grp-group"),i=e(this).parents("."+n.formCssClass).first(),s=r.find("#id_"+n.prefix+"-TOTAL_FORMS"),o=r.find("#id_"+n.prefix+"-MAX_NUM_FORMS");n.onBeforeRemoved(i);i.remove();var u=parseInt(s.val(),10);s.val(u-1);if(o.val()!==0&&o.val()-s.val()>0){showAddButtons(r,n)}var a=/-\d+-/g,f=0;r.find("."+n.formCssClass).each(function(){updateFormIndex(e(this),n,a,"-"+f+"-");f++});n.onAfterRemoved(r)})};deleteButtonHandler=function(t,n){t.bind("click",function(){var t=e(this).prev(),r=e(this).parents("."+n.formCssClass).first();n.onBeforeDeleted(r);if(r.hasClass("has_original")){r.toggleClass(n.predeleteCssClass);if(t.prop("checked")){t.removeAttr("checked")}else{t.prop("checked",true)}}n.onAfterDeleted(r)})};hideAddButtons=function(e,t){var n=e.find("a."+t.addCssClass);n.hide().parents(".grp-add-item").hide()};showAddButtons=function(e,t){var n=e.find("a."+t.addCssClass);n.show().parents(".grp-add-item").show()}})(grp.jQuery)